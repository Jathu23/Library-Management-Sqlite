<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lend Requested Lists</title>
    <link rel="stylesheet" href="../new-admin/style.css">
    <style>
        /* Basic styles for better presentation */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .details {
            margin: 20px 0;
        }

        .cardHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search input {
            padding: 5px;
            width: 200px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        button {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="details" id="book-inventory-field" style="display: block;">
        <div class="recentorders">
            <div class="cardHeader">
                <h2>Lend Book</h2>
                <div class="search">
                    <label>
                        <input type="text" placeholder=" 🔍 Search" id="searchInput" oninput="filterTable()" />
                    </label>
                </div>
            </div>
            <div class="mainbar">
                <div class="issue-book display-none" id="issue-book-div">
                    <div class="issue-div">
                        <form id="issue-bookform" onsubmit="return false;">
                            <div class="issue-book-inputs-div">
                                <h3>Issue Book</h3>
                                <div class="full-width">
                                    <input class="form-input" type="text" placeholder="Book-Id" id="issue_bookid"
                                        oninput="fetchBookDetails()" />
                                </div>
                                <div class="full-width">
                                    <input class="form-input" type="text" placeholder="User-NIC" id="issue_userid"
                                        oninput="fetchUserDetails()" />
                                </div>
                                <div class="full-width">
                                    <input class="form-input" type="text" placeholder="Copies" id="issue_bookcount" />
                                </div>
                                <div class="full-width">
                                    <input class="form-input" type="date" id="issue_date" />
                                </div>
                                <button class="form-btn" id="issue-book-btn">Issue</button>
                            </div>
                        </form>
                        <div class="detaildiv">
                            <div class="issue-info-div" id="issue-info">
                                <div class="info">
                                    <h4>Book Title</h4>
                                    <p id="book-title">--------</p>
                                </div>
                                <div class="info">
                                    <h4>Author</h4>
                                    <p id="book-author">--------</p>
                                </div>
                                <div class="info">
                                    <h4>ISBN</h4>
                                    <p id="isbn">-----------</p>
                                </div>
                                <div class="info">
                                    <h4>Publish Year</h4>
                                    <p id="book-publish-date">----------</p>
                                </div>
                                <div class="info">
                                    <h4>Number of Availabe Copies</h4>
                                    <p id="book-count">----------</p>
                                </div>
                                <div class="info">
                                    <h4>Return Date</h4>
                                    <p id="book-return-date">-----------</p>
                                </div>
                            </div>
                            <div class="issue-info-div" id="issue-user">
                                <div class="info">
                                    <h4>User Name</h4>
                                    <p id="user-name">--------</p>
                                </div>
                                <div class="info">
                                    <h4>Phone Number</h4>
                                    <p id="user-phone">--------</p>
                                </div>
                                <div class="info">
                                    <h4>Email</h4>
                                    <p id="user-email">-----------</p>
                                </div>
                                <div class="info">
                                    <h4>Join Date</h4>
                                    <p id="user-join-date">----------</p>
                                </div>
                                <div class="info">
                                    <h4>Pending Books</h4>
                                    <p id="user-pending-books">----------</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchBookDetails() {
            const bookID = document.getElementById('issue_bookid').value;
            if (bookID) {
                const response = await fetch(`http://localhost:3000/books?BookID=${bookID}`);
                console.log(response)
                if (response.ok) {
                    const bookData = await response.json();
                    console.log(bookData)
                    if (bookData.length > 0) {
                        const book = bookData[0];
                        document.getElementById('book-title').textContent = book.Title || 'Not Found';
                        document.getElementById('book-author').textContent = book.AuthorName || 'Not Found';
                        document.getElementById('isbn').textContent = book.ISBN ; // Adjust as necessary
                        document.getElementById('book-publish-date').textContent = book.PublishYear || 'Not Found';
                        document.getElementById('book-count').textContent = book.Copies || 'Not Found';
                        document.getElementById('book-available-count').textContent = book.AvailableCopies || 'Not Found';
                    }


                } else {
                    clearBookDetails();
                }
            } else {
                clearBookDetails();
            }
        }

        async function fetchUserDetails() {
            const userNic = document.getElementById('issue_userid').value;
            if (userNic) {
                const response = await fetch(`http://localhost:3000/users?NICNumber=${userNic}`);
                if (response.ok) {
                    const userData = await response.json();
                    clearUserDetails(); // Clear previous details

                    if (userData.length > 0) {
                        const user = userData[0]; // Assuming NIC is unique
                        document.getElementById('user-name').textContent = user.FirstName || 'Not Found';
                        document.getElementById('user-phone').textContent = user.PhoneNumber || 'Not Found';
                        document.getElementById('user-email').textContent = user.Email || 'Not Found';
                        document.getElementById('user-join-date').textContent = user.JoinDate || 'Not Found';
                        document.getElementById('user-pending-books').textContent = user.RentCount || 'Not Found';
                    } else {
                        clearUserDetails();
                    }
                } else {
                    clearUserDetails();
                }
            } else {
                clearUserDetails();
            }
        }



        function clearBookDetails() {
            document.getElementById('book-title').textContent = '--------';
            document.getElementById('book-author').textContent = '--------';
            document.getElementById('book-publisher').textContent = '-----------';
            document.getElementById('book-publish-date').textContent = '----------';
            document.getElementById('book-count').textContent = '----------';
            document.getElementById('book-return-date').textContent = '-----------';
        }

        function clearUserDetails() {
            document.getElementById('user-name').textContent = '--------';
            document.getElementById('user-phone').textContent = '--------';
            document.getElementById('user-email').textContent = '-----------';
            document.getElementById('user-join-date').textContent = '----------';
            document.getElementById('user-pending-books').textContent = '----------';
        }
    </script>
</body>

</html>